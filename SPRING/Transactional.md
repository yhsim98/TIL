https://mangkyu.tistory.com/154

# Spring이 제공하는 Transaction 핵심 기술
## 트랜잭션 동기화
트랜잭션 동기화란 트랜잭션을 시작하기 위한 Connection 객체를 특별한 저장소에 보관해두고 필요할 때 꺼내쓸 수 있도록 하는 기술이다.

트랜잭션 동기화 저장소는 작업 쓰레드마다 Connection 객체를 독립적으로 관리하기 때문에, 멀티쓰레드 환경에서도 안전하다.

하지만 JDBC가 아닌 Hibernate 와 같은 기술을 사용한다면 Connection이 아닌 Session 객체를 사용하기 때문에 문제가 생길 수 있다. 이러한 기술 종속적인 문제를 해결하기 위해 Spring은 트랜잭션 관리 부분을 추상화한 기술을 제공하고 있다.

## 트랜잭션 추상화
spring은 트랜잭션 기술의 공통점을 담은 트랜잭션 추상화 기술을 제공한다. 이를 통해 기술에 종속적인 코드가 아닌 일관된 트랜잭션 처리가 가능하다.

[](!https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F6eLCk%2Fbtq5gFwQO4x%2FKT2qebNokRvImqLY6iKcK0%2Fimg.png)

## AOP를 이용한 트랜잭션 분리
@Transactional 을 통하여 aop를 적용하여 비즈니스 로직과 트랜잭션 처리 로직을 분리할 수 있게 되었다.

# Spring 트랜잭션의 세부 설정
Spring의 DefualtTransactionDefinition이 구현하고 있는 TransactionDefinition 인터페이스는 트랜잭션의 동작방식에 영향을 줄 수 있는 **네 가지 속성**을 정의하고 있다. 해당 4가지 속성은 트랜잭션을 세부적으로 이용할 수 있게 도와주며, @Transactional 어노테이션에도 공통적으로 적용할 수 있다.

## 트랜잭션 전파
트랜잭션 전파란 트랜잭션 경계에서 이미 진행중인 트랜잭션이 있거나 없을 때 어떻게 동작할 것인가를 결정하는 방식을 의미한다.

* A의 트랜잭션에 참여
    * B의 코드는 새로운 트랜잭션을 만들지 않고 진행중인 트랜잭션에 참여할 수 있다
    * 오류가 발생할 경우 A와 B의 모든 작업이 취소된다
* 독립적인 트랜잭션 생성
    * A와 B의 트랜잭션을 독립적으로 만들 수 있다
* 트랜잭션 없이 동작
    * B가 readonly 라면 굳이 B의 작업에 트랜잭션을 걸 필요가 없다

이렇게 이미 진행중인 트랜잭션이 어떻게 영향을 미칠 수 있는가에 대한 부분이 트랜잭션 전파 속성이다. 트랜잭션을 시작하는 것처럼 보이는 getTransaction() 코드가 begin 이 아닌 get으로 이름이 지어진 이유도 여기에 있다. 해당 트랜잭션은 다른 트랜잭션에 묶여있을 수 있기 때문이다. 

이 외에도 여러 처리 방법을 지원한다

## 격리수준
모든 DB트랜잭션은 격리수준을 가지고 있어야 한다. 서버에서는 여러 개의 트랜잭션이 동시에 진행될 수 있는데, 모든 트랜잭션을 독립적으로 만들고 순차 진행한다면 안전하겠지만, 성능이 떨어질 수 밖에 없다. 따라서 적절하게 격리수준을 조정해서 가능한 많은 트랜잭션을 문제없도록 동시에 진행시키는 것이 필요하다. 

이는 JDBC 드라이버나 DataSource 등에서 재설정할 수 있고, 트랜잭션 단위로 격리수준을 조정할 수도 있다.

## 제한시간
트랜잭션을 수행하는 제한시간을 설정할 수 있다. 제한시간의 설정은 트랜잭션을 직접 시작하는 PROPAGATION_REQUIRED 등등의 경우에 사용해야만 의미가 있다

## 읽기 전용
읽기 전용으로 설정해두면 트랜잭션 내에서 데이터를 조작하려는 시도를 막아줄 수 있을 뿐만 아니라 데이터 액세스 기술에 따라 성능이 향상될 수 있다.


# 전파 속성
Spring이 제공하는 선언적 트랜잭션(@Transactional)의 장점 중 하나는 여러 트랜잭션 적용 범위를 묶어 하나의 커다란 트랜잭션 경계를 만들 수 있다는 점이다.
 
Spring이 트랜잭션을 어떻게 진행시킬 것인지 전파 속성을 설정할 수 있다.

7가지 전파속성이 있다.
* REQUIRED
* SUPPORTS
* MANDATORY
* REQUIRES_NEW
* NOT_SUPPORTED
* NEVER
* NESTED

