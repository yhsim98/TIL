# Cookie란?
저희가 주로 사용하는 HTTP 프로토콜은 비상태 프로토콜로서 이전 상태를 저장하지 않는 단점이 있습니다.

하지만 장바구니, 시청기록 등등 정보를 유지하는 stateful한 서비스의 필요성이 많아졌습니다.

이런 경우 Cookie를 사용할 수 있습니다.

Cookie
* 웹 서버가 브라우저에 지시하여 사용자의 로컬 컴퓨터 파일 또는 메모리에 저장하는 작은 기록 정보 파일
* 파일에 담긴 정보는 인터넷 사용자가 같은 웹 사이트를 방문할 때마다 읽히고 수시로 바뀔 수 있다

## Cookie 구성요소
* Name
    * 이름
* Value
    * 쿠키의 저장된 값
* Expires
    * 쿠기의 유효기간
    * ``expires="Wdy, DD-Mon-YYYY HH:MM:SS GMT"``
    * Max-Age를 통해 지정된 만료일이 되면 디스크에서 쿠키 제거
* Domain
    * 쿠키가 사용되는 도메인을 지정
    * ``dimain=koala.im``
    * 이 값이 현재 탐색 중인 도메인과 일치하지 않을 경우 다른 서버의 쿠키로 간주되며 브라우저에서 거부
    * 이것을 통해 한 도메인에서 다른 도메인에 대한 쿠키 접근 방지
* Path
    * 쿠키를 반환할 경로를 설정
    * ``path=/``
        * 도메인의 루트 경로로 이동할 경우 쿠키가 전송
* Secure
    * 보안 연결 설정
* HttpOnly
    * HTTP 외에 다른 통신 사용 가능 설정

## 쿠키 종류
* Session Cookie
    * 보통 만료시간 설정하고 메모리에만 저장되며 브라우저 종료시 쿠키를 삭제
* Persistent Cookie
    * 장기간 유지되는 쿠키, 파일로 저장되어 브라우저 종료와 관계없이 사용
* Secure Cookie
    * HTTPS에서만 사용, 쿠키 정보가 암호화되어 전송
* Third-Party Cookie
    * 방문한 도메인과 다른 도메인의 쿠키, 보통 광고 베너 등을 관리할 때 유입 경로를 추적하기 위해 사용


## 단점
* 쿠키에 대한 정보를 매 헤더에 추가하여 보내기 때문에 **상당한 트래픽**발생
* 쿠키는 유출되기 쉽기 때문에 보안 문제 발생 가능

# Session이란?
쿠키의 트래픽 문제와 보안 이슈를 해결하기 위해 등장

* HTTP Session id를 식별자로 구별하여 데이터를 사용자의 브라우저에 쿠키형태가 아닌 접속한 서버 DB에 정보를 저장한다
* 클라이언트는 HTTP Session id를 쿠키로 메모리 저장된 형태를 가지고 있다
* 메모리에 저장하기 때문에 브라우저가 종료되면 사라지게 된다

## Session 발급 절차
1. 클라이언트가 resource 요청
2. 서버는 HTTP Request 통해 쿠키에서 Session id 확인 후 없으면 `Set-Cookie`를 통해 새로 발행한 `Session-id` 보냄
3. 클라이언트는 HTTP Request 헤더에 Session id를 포함하여 원하는 Resource 요청
4. 서버는 Session id를 통해 해당 세션을 찾아 클라이언트 상태 정보를 유지하며 적절한 응답

## Server-side 관점의 세션
* 장점
    * 서버에 저장하기 때문에 관리하기 편함
* 단점
    * load-balancing 힘들다
    * scale out에 불리
    * 서버에 저장 공간이 필요하다

## 다중 서버에서 Session handling
보통 별도의 메모리형 데이터베이스에 저장하게 된다. 이것을 세션 스토리지라고 한다.
 
모든 서버가 같은 세션을 유지하거나 로드밸런싱하거나 하는 방법도 있지만 각자 부작용이 있다.

sticky session(로드벨런싱), 세션 클러스터링, 세션 스토리지




## Reference
https://nesoy.github.io/articles/2017-03/Session-Cookie
