# IP 서비스 개요
비연결형 서비스
* 연결 설정 과정 없음
* 일련의 데이터그램을 독립적으로 전달

최선형 서비스
* 전송속도, 지연시간 보장 없음
* 오류 복구 서비스 미지원

서브넷 독립적 서비스
* 다양한 서브넷을 통해 IP 데이터그램 전송 가능
* 서브넷 주소와 독립적인 IP 주소 사용

Hop-By-Hop 통신 서비스
* 연결형 서비스가 아니다...
* 어느 라우터를 통해 전송될 지 알 수 없다
* 각 라우터는 하나의 Hop에 대해서만 책임진다

계층구조
* 네트워크 계층의 프로토콜
* 데이터링크와 물리계층이 하위계층
* 상위도 있다

# IP 데이터그램
IP 데이터그램 구조
* 상위 프로토콜 데이터(IP) + MAC 주소

IP 데이터그램 단편화
* 서브넷에 따라 MTU(Maximum Transmission Unit)이 다름
    * 서브넷마다 최대 전송 가능 용량이 다르다는 뜻
    * 그래서 단편화 필요
    * 처음 단편화하고 가다가 추가로 단편화하고
* 목적지에 도착해서만 재조립한다

단편화 필드 설정
* 헤더를 자를 수는 없고 데이터를 자른다
* ID(identification) : 모든 파편이 동일
* 플래그(flag) : 마지막 데이터그램은 0, 나머지는 1
* 옵셋(offset) : 원래 데이터 필드에서의 상대적 위치(바이트수/8)
    * 데이터 크기 8이라 하면 첫번쨰는 0/8 = 0, 두번째는 8/8=1, 세번쨰는 16/8=2 .....
    * 원래 데이터의 상대적 위치이다. 쪼개진 데이터의 상대적 위치 아니다
    * 단편화되고 나중에 다시 단편화되더라도 처음 데이터의 상대적 위치
* 헤드는 똑같이 모든 조각에 붙임






# 인터넷 구성과 주소 부여 체계

Internet 
* 이기종 네트워크를 라우터로 연결
Subnet 
* 라우터로 연결된 서브넷은 인터넷에서 유일한 ID를 가짐
HOST
* 호스트는 서브넷에서 유일한 ID를 가짐 

# IP 주소
* 인터넷에서 통신 장치를 유일하게 식별
* Network ID + Host ID
* 네트워크 주소 : Host ID = 0

IP 주소 구조
* IPv4 : 32비트
    * 지금 거의 다 써감
* IPv6
    * IP 주소가 부족해져 새로 생성
    * 128비트

주소 구조 활용 방식
* 클래스 주소
* 비클래스 주소

클래스 주소
* 고정 길이 프리픽스(네트워크 id)
    * 네트워크 id를 클래스에 따라 다르게 고정
* 클래스 A 
    * 호스트 ip :24bits
* 클래스 B
    * 호스트 ip : 16bits....
    * 앞에 특수 비트 10 을 통해 클래스 B 인것을 나타낸다.
    * 2^(16 - 2), 총 2바이트를 네트워크 id로 사용하는데 처음 두 비트는 클래스 B인것을 나타내니 14비트를 네트워크 id 나타내는데 사용 
* 모두 0인 경우와 1인 경우는 할당할 수 없다
* 호스트 ip의 경우 할당할 수 있는 호스트의 개수
* 지금은 안쓴다
    * 사설 IP 주소는 아직 쓴다

클래스 주소의 주소 낭비 문제

비클래스 IP 주소
CIDR
* 임의의 길이의 프리픽스 네트워크 id 할당
* 네트워크 크기(호스트 수)에 맞는 프리픽스 네트워크 id 크기 설계 가능
    * 호스트 수에 따라 서브넷마스크를 달리하여 동적으로 id 할당 가능

서브넷마스크
* IP 주소에서 네트워크 ID의 길이(프리픽스 크기) 표시
* 네트워크 크기(호스트 개수)를 결정

서브넷마스크 표기법
* 프리픽스 표기법 : /prefix_size 표시
    * 옆에 직접 적는 것
* 이진 표기법 : 
* DDN 표기법 : 이진 서브넷마스크를 DDN으로 표시
    * 서브넷마스크는 1, 호스트는 0
* 예제
    * 프리픽스 서브넷마스크 : /24
    * 이진 서브넷마스크 : 11111111 1111111 11111111 00000000
    * DDN 서브넷 마스크 : 255.255.255.0

특수 주소
* 브로드캐스트 주소 : 호스트 ID의 모든 비트 1
    * 네트워크에 연결되어있는 모든 호스트들을 다 지정할 때 사용
    * 전부 다 1이어야 하는 것은 아님
    * xxx.xxx.xxx.255/12 
* 네트워크 주소 : 호스트 ID의 모든 비트 0
    * 

IP 주소 분석 : 200.100.11.1/23
* 네트워크 주소 : 200.100.10.0/23
* 브로드캐스트 주소 : 200.100.11.255/23
    * 32 개중 23개를 id로 사용 나머지 9개를 호스트로 사용
    * 브로드캐스트의 경우 나머지 9개가 1
* 최대 호스트 주소 = 네트워크 주소 ~ 브로드캐스트 주소
    * 남은 비트 모두 0이나 1은 사용못하니 제외
    * 위의 경우 2^9 - 2 = 510
* 이렇게 특수주소 2개는 호스트 주소로 사용못함
* 네트워크 주소 계산은 서브넷마스크와 IP 주소를 & 연산한 것


# IP 주소 할당
NIC(network interface card) 단위의 IP 주소 할당
* 라우터 : 3개의 NIC로 네트워크 연결
* 라우터의 IP 주소 : NIC 개수만큼 IP 주소 할당


# 네트워크 주소 기반 라우팅
* 라우팅 테이블 크기 축소
    * Ip 일부를 호스트 아이디, 일부를 
    * IP 일부만 있어도 한기대까지는 올 수 있다
    * 와서 남은 IP를 가지고 호스트 찾아감
    * 이렇게 하면 라우팅 테이블에 모든 호스트가 들어가 있는 것이 아니라 한기대만 있으면 된다
    * 이렇게 라우팅 테이블 크기가 작아진다 
* 인터넷 성능 제고

# 라우터로 연결된 네트워크 식별
* 라우터와 라우터가 연결된 것도 네트워크
* 포인트 투 포인트 네트워크라 한다
* 얘들도 유일한 id를 가져야 한다


# DHCP(Dynamic Host Configuration Protocol)
IP 주소 할당
* 고정 할당 : 수동 할당, 고정 할당
* 동적 할당 : 자동 할당, 유동 할당

DHCP
* DHCP 서버에 의한 호스트 구성 정보 동적 할당 절차 정의
* IP 주소, 서브넷마스크, 디폴트 게이트웨이 주소, DNS 서버 주소 등 구성 정보 자동 할당

DHCP의 장점
* 사용자 편의성
* IP 주소 절약
    * 필요할 때만 할당
    * 동시 사용자 수만큼 할당


호스트 구성정보
* 호스트를 구성하는 정보를 DHCP가 유지하고 있다
* IP 주소 : 호스트의 IP 주소
* 서브넷 마스크 : 네트워크 ID 필드 크기, 네트워크 주소 구분을 위한 필수 정보
* 디폴트 게이트웨이 주소 : 자신의 네트워크에 연결된 라우터의 주소, 목적지 주소가 동일 네트워크에 존재하지 않을 때 IP 데이터그램을 전달할 다음 홉 주소
* DNS 서버 주소 : 지역(local) DNS 서버의 주소, DNS Query를 전달할 서버


DHCP 동작절차
1. 우선 DHCP server 가 존재하는지 클라이언트가 discover 메시지를 보낸다
    * 자기주소는 32비트 전부 0, 목적지 주소는 네트워크 ID 까지 32비트 전부 1
    * 자기 transaction ID, yiaddr
2. 



# NAPT
필요할 때만 사설 IP 주소를 할당하는 것

