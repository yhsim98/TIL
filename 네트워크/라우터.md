# 인터넷
Network of Networks
* Internet : 이기종 네트워크를 라우터로 연결
* Subnet : 인터넷에서 유일한 ID를 가짐
* Host : 서브넷에서 유일한 ID를 가짐

Subnet
* 서로 다른 종류의 네트워크
* 서로 다른 주소 체계
* 서로 다른 통신 체계
* 인터넷에는 여러 subnet이 있고 다 다를 수 있다


인터넷 차원의 주소 : IP 주소
* 인터넷에서 통신 장치를 유일하게 식별
* Network ID + Host ID
* 논리적 주소(Logical Address)

서브넷 차원의 주소 : 서브넷 의존 주소
* 서브넷에서 통신 장치를 유일하게 구분
* 서브넷에서 종류에 따라 다른 주소 사용
* MAC 주소, 전화 번호
* 물리적 주소


# DHCP 개요
IP 주소 할당
* 고정 할당 : 수동 할당, 고정 할당
* 동적 할당 : 자동 할당, 유동 할당

DHCP
* DHCP 서버에 의한 호스트 구성 정보 동적 할당 절차 정의
* IP 주소, 서브넷 마스크, 디폴트 게이트웨이 주소, DNS 서버 주소 등 구성 정보 자동 할당

DHCP의 장점
* 사용자 편의성
* IP 주소 절약(필요할 때만, 동시 사용자 수만큼 할당)

호스트 구성 정보
* IP 주소 : 호스트 IP 주소
* 서브넷마스크 : 네트워크 ID 필드 크기, 네트워크 주소 구분을 위한 필수 정보
* 디폴트 게이트웨이 주소 : 자신의 네트워크에 연결된 라우터의 주소, 목적지 주소가 동일 네트워크에 존재하지 않을 때 IP 데이터그램을 전달한 다음 홉 주소
* DNS 서버 주소 : 지역 DNS 서버의 주소, DNS Query를 전달할 서버


# 인터넷 라우팅 개요
인터넷 : 가중치 그래프
* 인터넷이란 라우터들을 비용이 매겨진 링크로 연결한 그래프이다
* 링크의 유형에 따라 링크 사용 비용에 차이가 있다
* 라우터가 선호하는 링크의 비용이 낮음
* 최소 비용 경로 : 출발지 라우터와 목적지 라우터를 연결하는 경로 중에 링크 비용의 합이 가장 작은 경로
* 링크 비용 : c(u, x) = 1, 최소경로비용 Duz = 4

Hob-by-Hop 라우팅
* 라우터들을 비용이 매겨진 링크로 연결한 그래프에서 출발지 라우터에서 목적지 네트워크의 라우터까지 최소비용경로를 찾고,
* 최소 비용 경로상의 다음 라우터의 주소를 라우팅 테이블에 저장

# 거리 벡터 개념
거리 벡터
* 특정 라우터에서 다른 모든 라우터까지의 최소 경로 비용을 갖는 1열 벡터
* u[] : 라우터 u의 전체 거리 벡터
* u[x] : 라우터의 u에서 라우터 x까지 거리
* 거리 벡터 공유를 통한 거리 벡터 갱신 : x -> u 로 거리 벡터 전달
* 벨먼-포드 방정식으로 구한다

개념 : 분산 라우팅
1. 이웃 라우터와 자신의 초기 거리 벡터 공유
2. 이웃 라우터의 거리 벡터와 벨먼-포드 방정식으로 자신의 거리 벡터 갱신
3. 갱신된 거리 벡터를 이웃 라우터에 전달

무한 계산 문제
* 이웃 라우터를 경유하는 경로로 최소 경로 비용을 갱신하고, 해당 이웃 라우터에게 다시 전송하는 과정이 반복되는 문제

문제 발생 이유
* 링크가 고장나거나 비용이 증가할 때 발생
* 이웃 라우터가 자신을 경유하는 최소 경로 비용 전송
* 2개의 이웃 라우터 간의 순환 경로 발생

포이즌 리버스
* 상대방 이웃 라우터를 경유하는 최소 경로 비용을 infinite로 변경하여 통보

무한 계산 문제
* 3개의 노드 불완전성 문제
* 이 경우 포이즌 리버스 적용안됨
* 그래서 infinite 대신 16으로 대체한다
    * 그러면 순환이 최대 16번으로 제한된다

# 링크 상태 라우팅 알고리즘
LSP(link state packet) 플러딩(flooding)
* 초기 링크 상태를 전체 라우터와 공유, 다익스트라 알고리즘과 별개의 라우팅 프로토콜에 의해 수행
* 자신이 가지고 있는 링크 정보를 다른 모든 라우터에게 알리는 작업
    * 자기자신이 연결된 가중치 링크의 값

링크 상태 데이터베이스(LSDB)
* LSP 플러딩 결과 모든 라우터가 동일한 LSDB 유지
* 모든 라우터에서 다른 라우터로 가는 최소비용 유지되있는 DB


# 라우팅 프로토콜 RIP
라우팅 프로토콜 관점의 인터넷
* AS(Autonomous System)들의 상호 연결
* AS : 인터넷상의 개별적인 라우팅 관리 도메인(ISP)

인터넷 라우팅 
* 전체 인터넷을 여러 개의 AS로 나누고, AS 내부는 각각 독립적인 라우팅 프로토콜 적용
* AS간 라우팅은 각 AS를 연결하는 라우터들 간에 별도의 프로토콜로 수행
* 라우팅 프로토콜의 종류가 AS 내부용, AS간 연결용 두 가지 있다

Intra-AS 라우팅 프로토콜
* AS 내부에 적용가능한 라우팅 프로토콜(IGP)
* RIP, OSPF, ....

Inter-AS 라우팅 프로토콜
* AS 간에 적용가능한 라우팅 프로토콜
* BGP

RIP(Routing Information Protocol)
* 초기 IP와 함께 개발된 최초의 라우팅 프로토콜, 현재 버전 2
* 거리 벡터 라우팅 알고리즘에 근거한 분산 라우팅
* 모든 링크의 비용은 1로 설정
* 최고 경로 비용을 15로 제한
* 경로 비용이 16인 경우는 무한대로 간주하여 해당 경로는 유효하지 않는 경로로 처리

RIP 메시지 포맷 : 이웃 라우터와 라우팅 정보 교환
* 메시지 유형
    * 요청 메시지
    * 응답 메시지
* 목적지 IP주소
* 목적지 subnetmask
* 목적지 까지의 거리
* 경로상의 자기 다음 라우터

## RIP 메시지 전송 절차
응답 메시지
* 요청 메시지의 요청에 의해 송신될 수도 있으나
* 이웃 라우터들에게 주기적(약 30초)으로 송신
* 트래픽 동시 발생을 회피하기 위해 25~30초 사이의 임의의 시간에 전송
* 광고 메시지로 부름
* 라우팅 벡터 알고리즘은 갱신되면 바로 보냄, 하지만 RIP는 약 30초마다 보냄

유효 경로 확인
* 이웃 라우터로부터 일정 시간 동안 특정 경로에 대한 RIP 응답 메시지를 받지 못하면, 
* 해당 경로는 유효하지 않은 경로로 간주되어 경로 비용이 무한대(16)으로 설정
* 주기적으로 보내는데 도착하지 않는다는 얘기는 못온다는 것

요청 메시지(Request Message)
* 라우터가 초기화되었을 때 요청
* 라우팅 테이블의 특정 엔트리가 타이머가 종료될 때까지 갱신되지 않아 사용할 수 없게 되었을 때 송신
    * 다른 라우터에게 해당 라우터로 가는 경로가 있는지 요청
* 특정 네트워크 주소를 지정하여 특정 엔트리의 라우팅 정보를 요청할 수도 있다
* 네트워크 주소를 0으로 설정함으로써 모든 엔트리의 라우팅 정보 요청 가능

## RIP 라우팅 테이블 갱신
경로 거리 재계산
* 응답 메시지와 각 목적지에 대해 수신 경로 거리에 1을 더하여 새로운 경로 거리 계산

라우팅 테이블 갱신
1. 수신된 경로가 기존 라우팅 테이블에 없으면 경로 추가
2. 수신된 경로의 거리가 라우팅 테이블의 기존 경로 거리 보다 작으면 수신 경로로 갱신
3. 수신된 경로의 거리가 라우팅 테이블의 기존 경로 보다 크더라도, 다음 라우터가 동일하면 수신 경로로 갱신
    * 이는 동일한 다음 홉 라우터를 경유하는 경로의 거리 비용이 증가한 경우
    * 같은 경로인데 비용만 높아졌다는 뜻 
4. 1~3이 아닌 경우 수신된 경로 무시


## RIP 문제점
* 라우팅 트래픽 발생량 증가
    * 주기적으로 발생되는 RIP 메시지는 목적지 망 주소와 거리 정보를 포함하는 많은 목록의 라우팅 정보를 포함하므로 라우팅 트래픽 발생량이 많다
* 라우터의 성능 저하
    * 짧은 주기로 발생되는 RIP 메시지를 수신할 때 마다 라우터는 수신된 메시지의 목록의 각 항목을 자신의 거리 테이블의 관련 항목과 비교하고 처리해야 하므로 라우터의 성능 저하가 초래하게 된다
* 느린 전파 속도 
    * 라우팅 테이블 갱신 정보는 한 번에 하나의 라우터씩 전달되기 때문에 갱신 정보의 전파 속도가 느리다
* 차등화된 라우팅 불가
    * RIP의 모든 링크 비용은 1로 설정되므로 요구되는 서비스 유형에 따라 차등화된 경로 선택이 원천적으로 불가능하다
    * 링크따라 전송속도가 다를 수 있다, 전화선, 랜선 등등
    * 거리 보다 전송 속도가 높은 경로 선택 불가


# 라우팅 프로토콜 : OSPF
OSPF 동작 원리
1. 각 라우터는 링크의 상태에 변화가 있는 경우에만 변화의 내용을 모든 라우터에게 플러딩(flooding)함으로서 갱신된 상태 정보를 모든 라우터와 동시에 공유
2. 각 라우터는 글로벌 네트워크 상태 정보에 다익스트라 알고리즘을 실행하여 모든 라우터에 대한 최소 비용 경로 계산
3. 최소 비용 경로 계산 결과에 따라 라우팅 테이블 갱신

OSPF의 장점
1. RIP에 비해 적은 량의 라우팅 트래픽을 유발
2. RIP 보다 라우팅 정보 관련 갱신 회수가 줄어들어 빈번한 처리 지연 발생으로 인한 라우터의 성능 저하 방지
3. 플러딩 방식의 갱신 정보 전송으로 인해 갱신 정보 전파 속도가 빠름
4. 링크 특징에 따라 링크비용을 다르게 설정하는 것을 허용

OSPF 동작 절차
1. OSPF가 설정된 라우터 간에 주기적(10초)으로 헬로 패킷을 주고 받으며 인접 이웃관계 형성
2. 각 라우터는 갱신된 링크 상태 정보가 포함된 링크 상태 패킷 또는 LSA 생성
3. LSA를 모든 라우터들에게 플러딩 함으로써 링크 상태 갱신 정보 공유
4. 모든 라우터는 동일한 링크 상태 데이터베이스(LSDB) 유지
5. 각 라우터는 자신의 LSDB에 대해 다익스트라 알고리즘을 적용하여 모든 라우터에 대한 최소 비용 경로 계산
6. 계산된 최소 비용 경로를 바탕으로 라우팅 테이블 설정

헬로 패킷
* 직접 연결된 네트워크의 라우터들간에 교환
* 헬로 패킷을 수신하면 해당 라우터와 이웃 관계 설정
* 헬로 패킷에 이웃 라우터 표시 
* DR 라우터가 존재하는 경우 DR 라우터만 이웃 관계 설정

DR(Designated Router)
* 네트워크에 연결된 다수의 라우터의 대표 라우터
* 나머지 라우터는 DR과만 이웃관계를 설정

DR 선정 절차
* 헬로 패킷을 교환하면서 선정
* OSPF 우선순위가 가장 높은 라우터가 DR이 되고 그 다음 라우터가 BDR
* OSPF 우선순위가 동일하면 라우터 ID가 가장 높은 라우터가 DR이 되고 그 다음 라우터가 BDR
* DR이 다운되면 BDR이 DR이 되고 BDR은 새로 선정

LSA 패킷
* 링크 상태를 알려주는 패킷

## OSPF 계층 구조
문제점
* 자율 시스템(AS)의 규모가 커지면 메시지 플러딩으로 인한 라우팅 트래픽 증가
* AS의 규모가 커지면 각 라우터가 유지해야 되는 네트어크의 상태 정보의 양 증가

계층 구조 적용
* 하나의 AS를 여러 개의 영역(Area)로 나눔
* 각 영역은 독립적으로 OSPF 라우팅을 수행
* 영역 간의 라우팅은 백본 영역를 통해서 수행

 ## OSPF LSA
LSA 유형


# 라우팅 프로토콜 BGP
AS(Autonomous System)
* 독립적인 라우팅 프로토콜 관리 도메인
* 좋은 경로에 대한 독립적인 선택 정책 적용
* 유일한 ID(AS Number)로 구분

BGP
* AS간에 적용할 수 있는 유일한 표준 라우팅 프로토콜
* 서로 다른 AS의 목적지에 대한 경로 정보 제공
* 경로 벡터(Path Vector) 라우팅 알고리즘 기반

경로 벡터(Path Vector)
* 모든 목적지까지의 거리(비용) 자료 구조
* 이웃 라우터가 전달한 거리 벡터를 사용하여 계산
* 경로 속성(Path Attributes) : 거리(distance), 다음 라우터(이웃 라우터)
* 전체 경로 정보 제공 불가 : 순환 경로(loop) 발생 가능, 단일 경로 선택 기준(거리)








