# TCP 


# TCP 연결
1 : 1 소켓 연결
* 연결 설정 과정(handshaking) 필요
* 서버 연결 소켓 : 서버 IP 주소와 서버 Port 번호 공유 가능
* 멀티캐스팅 지원 불가

Full-duplex(전이중) 통신
* 양방향 동시 세그먼트 전송
    * UDP는 단방향
* MSS : 세그먼트의 데이터 필드 최대 크기
* 송신 버퍼에서 MSS 단위로 송신

바이트 스트림(Byte Stream) 전송
* 송신 프로세스가 소켓의 송신 버퍼에 전달(write)한 바이트 스트림을 수신 소켓의 수신 버퍼에 순서대로 전송
* 송신 프로세스는 송신 버퍼에 임의의 크기의 바이트열을 씀, TCP는 세그먼트 단위(MSS)로 수신 버퍼에 전달, 수신 프로세스는 수신 버퍼에서 원하는 크기의 바이트열을 읽음

3-way handshake
* 클라이언트와 서버 간에 동기를 맞추는 과정
    * 소켓과 소켓간에 싱크를 맞춤
* 동기 정보 : 소켓 주소, 시작 순서 번호, 수신 윈도우 크기

SYN 세그먼트
* 일반적인 TCP 세그먼트에 헤더의 타입에 SYN 비트를 1로 설정
* 데이터가 없다
    * 하지만 가상적으로 한 바이트가 데이터가 있는 것처럼 설계
    * 가상적으로 함으로써 다음 데이터 전송 시 사용할 순서번호를 ACK로 반환해 줌
    * SYN 번호 + 1
* 연결 설정을 위해 클라이언트 TCP가 서버 TCP에 전송
* 시작 순서 번호(ISN) 설정
    * 무려 32비트
* ACK를 위해 순서번호 1 소비
    * 가상의 1 바이트 데이터 전송

SYN + ACK 세그먼트
* SYN 세그먼트를 수신한 서버 TCP가 클라이언트 TCP에 전송
* SYN 비트와 ACK 비트 1 설정
* 시작 순서 번호(ISN) 설정
* 확인 번호(ACK) 설정
    * SYN가 사용한 번호 + 1
    * SYN이 데이터 1바이트 있다고 가정하고 순서번호 하나 딸려 보냄
* 수신 윈도우 크기 설정
* ACK를 위해 순서번호 1 소비
    * 가상의 1바이트
* 이후 DATA 세그먼트 전송

ACK 세그먼트
* SYN + ACK 세그먼트를 받았다고 클라이언트에서 다시 서버로 전송
* 헤더에서 ACK 비트를 1로 설정
* 수신 윈도우 크기 설정
* 데이터 포함 가능
* 데이터 미포함 시에는 순서 번호 소비하지 않음
    * 가상의 1 바이트 추가하지 않는다
    * 이전의 SYN때 썼던 번호 재사용
* 이후 DATA 세그먼트 전송

# TCP 연결 해제
4-way Handshake 과정을 거친다.  
서로 FIN 보내고 ACK 보내서 4way, 서버도 연결을 끊고 싶다면 ACK와 FIN 같이 보낼 수 있음.

3-way Handshake
* 서버가 ACK FIN 합쳐서 보내서 3-way
* 클라이언트가 ACK 보낸다음 RTT가 있다가 종료된다.
    * ACK 가 손실될 수 있기 때문이다.