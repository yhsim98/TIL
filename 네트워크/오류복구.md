# 전송오류복구
정보 전송 단위
* IP, UDP : 데이터그램
* TCP : 세그먼트

세그먼트 구조
![](https://t1.daumcdn.net/cfile/tistory/994511465AF2DC262D)

## 세그먼트 오류
세그먼트 오류 
* 세그먼트 훼손 : 훼손된 세그먼트 도착(Checksum으로 확인)
    * 전송한 세그먼트와 다른 세그먼트가 도착
* 세그먼트 손실 : 세그먼트 미도착(중간 통신장치의 버퍼 오버플로우)

세그먼트 수신 확인
* 세그먼트 정상 수신 -> 수신확인(ACK) 세그먼트 회신
* 훼손 세그먼트 수신 -> 폐기 -> 미수신
* 세그먼트 미수신 -> 인지 불가

ACK
* 수신자가 데이터 세그먼트의 정상수신을 확인하기 위해 송신자에게 보내는 특수한 세그먼트
* 세그먼트의 헤더의 타입이 세그먼트비트가 0이 아닌 1

세그먼트 미수신 확인
* 세그먼트 전송 후 타이머 개시
* 타이머 종료시까지 ACK 미도착
    * 이 경우 훼손됬거나 미수신했다고 판단

타이머 설정
* RTT(Round Trip Time)과 연계된 함수
    * RTT : ACK가 돌아로기까지 시간
    * RTT보다는 길게 

오류 세그먼트 복구 절차
1. 세그먼트 전송, 타이머 시작
2. 세그먼트 타이머 종료시까지 ACK 미도착
3. 세그먼트를 재전송, 타이머 재시작

# Stop-and-Wait ARQ(Automatic Repeat Request)
송신자
1. 세그먼트 송신 후 복제본을 버퍼에 유지
2. 재전송 타이머 시작
3. 타이머 종료 전 ACK 수신 시 복제본 폐기, 타이머 종료
4. 타이머 종료 전 ACK 미수신 시 세그먼트 재전송, 타이머 재시작

수신자
1. 정상 세그먼트 수신 시 ACK 회신

문제점
* ACK 세그먼트에 오류 발생 시 중복 전송
* 수신자는 중복 세그먼트 여부 구분 불가

## SN
SN : 순서번호
* 각 세그먼트에 대한 순서 번호 : 동일 종류 세그먼트간 구분
* 송신 SN : 현재 송신 세그먼트 번호
* ACK SN : 다음 송신 세그먼트 번호(송신 SN + 1)
    * 송신자가 다음에 보낼 세그먼트 번호

SN 범위 : [0, 1]
* SN 필드 크기 : 1비트 
    * 0과 1만 있어도 된다
* Alternation Protocol


## Stop-and-Wait ARQ 문제점
SN 없는 경우
* ACK 세그먼트에 오류 발생 시 중복 전송
* 수신자는 중복 세그먼트 여부 구분 불가

SN 있는 경우
* ACK가 도착할 때까지 전송 대기
* 대기 시간동안 링크 미사용 -> 링크 사용률 저하
    * ACK를 기다리는 동안 링크 사용하지 못한다
* 결국 링크 효율이 낮아 실제로 사용하기는 어렵다

링크 효율
* 세그먼트 크기 : 1000비트
* 링크 전송속도 : 1Mbps
* RTT : 20ms
* 20ms 동안 송신 가능 비트수 : 1000000/s * 0.02s = 20000비트
    * 링크 전송속도 * 시간
* 20ms 동안 실제 송신 비트수 : 1000비트
    * Stop-and-Wait 시
* 링크 효율 : 1000/20000 = 0.05(5%)


